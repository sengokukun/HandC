$.tip={create:function(t,i,e,a,n){var d=document.createElement("div");$(d).addClass("validationTip").attr("id",t+"_tip");var s=$("#"+t).offset(),c={},l=function(t,i){c.top=t+a+s.top,c.left=i+n+s.left};switch(e){case"top":l(0,0);break;case"bottom":l($("#"+t).height(),0);break;case"even":l(0,n);break;default:l(0,$("#"+t).width())}$(d).append("<div class='tipInner'>"+i+"</div><div class='tipRt'></div><div class='tipRb'></div>").hide().css({position:"absolute",top:c.top,left:c.left}),$("body").append(d)},msg:function(t,i){$("#"+t+"_tip .tipInner").html(i)},fadeIn:function(t){$("#"+t+"_tip").fadeIn("normal")},fadeOut:function(t){$("#"+t+"_tip").fadeOut("normal")}},$.dialog={ids:{mat:"dlgmat",me:"dlg",top:"dlgtop",cont:"dlgcont",btm:"dlgbtm",close:"close"},create:function(t){var i=document.createElement("div"),e=document.createElement("div"),a=document.createElement("span"),n=$.dialog.ids,d=function(){$(e).fadeTo(1,0).hide(),$(i).fadeTo(1,0).hide(),$("select:hidden,object:hidden").css("visibility","visible")};$("body").keyup(function(t){27==t.keyCode&&d()}),$(i).attr("id",n.mat).hide().fadeTo(1,0).click(function(){d()}),$(a).attr("id",n.close).click(function(){d()}).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}),$(e).append("<div id='"+n.top+"'></div><div id='"+n.cont+"'><div><span></span></div></div><div id='"+n.btm+"'></div>"),$("body").append(i).append(e);({width:$(e).width(),height:$(e).height()});$(e).attr("id",n.me).append(a),$("div span","#"+n.cont).html(t),$(e).css("display","inline"),$("div",e).css("display","inline"),$("div","#"+n.cont).css("display","block"),"undefined"==typeof document.body.style.maxHeight&&$(e).width($(e).width()),$(e).hide().fadeTo(1,0)},fadeIn:function(t,i){var e=$.extend({duration:"fast",matOpacity:.6,dialogOpacity:.9,closeTitle:"このメッセージを閉じる"},i),a=$.dialog.ids;$("#"+a.cont+" div span").html(t),$("#"+a.me).show();var n={width:$("#"+a.me).width(),height:$("#"+a.me).height()};$("#"+a.me).css("display","block"),$("div","#"+a.me).css("display","block"),$("#"+a.close).attr("title",e.closeTitle),$("#"+a.mat).show().fadeTo(e.duration,e.matOpacity),$("#"+a.me).fadeTo(e.duration,e.dialogOpacity).css({"margin-left":"-"+n.width/2+"px"}),"undefined"!=typeof document.body.style.maxHeight?($("#"+a.me).css({"margin-top":"-"+parseInt(n.height/2)+"px"}),document.all&&$("#"+a.top+",#"+a.btm).css("min-width",n.width)):$("select,object").css("visibility","hidden")}},$.validate={chk:{required:function(t,i){if($(i).hasClass("group")){var e=0;return $("input,select",i).each(function(){$(this).val().length>0&&e++}),t&&e==$("input,select",i).length}return t&&t.length>0},hankaku:/^[a-zA-Z0-9@\;\:\[\]\^\=\/\!\*\"\#\$\%\&\'\(\)\,\.\-\_\?\\\s]*$/,email:/^[a-zA-Z0-9_\.\-]+?@[A-Za-z0-9_\.\-]+\.+[A-Za-z\.\-\_]+$/,tel:/^[\d-]*$/,numonly:/^\d*$/,zip:/\d\d\d\-?\d\d\d\d/,check:function(t,i){return $("input:checked",i).length>0},radio:function(t,i){return $("input:checked",i).length>0},retype:function(t,i){var e=$("#"+$(i).attr("class").split("retype-")[1].split(/\b/)[0]);if(!e.hasClass("group"))return e.val()==t;for(var a=$("input",e),t=$("input",i),n=0,d=!1;n<a.length;n++)d=a[n].value==t[n].value;return!!d||void 0},min:function(t,i){var e=$(i).attr("class").match(/min(\d+)/)?RegExp.$1:null;if(t.length>0)return t.length>=e},max:function(t,i){var e=$(i).attr("class").match(/max(\d+)/)?RegExp.$1:null;if(t.length>0)return t.length<=e}},fn:function(t,i){msgs=$.extend({retype:"直前の項目と同じ内容を入力してください",email:"正しいEメールアドレスを入力してください",hankaku:"全角文字は使えません",tel:"正しい電話番号を入力してください",numonly:"数字のみで入力してください",zip:"正しい郵便番号を入力してください",min:"文字以上で入力してください",max:"文字以内で入力してください",check:"ひとつ以上を選択してください",radio:"いずれかを選択してください",required:"必須項目です",submit:"必須項目を正しく入力してください"},i);var e=$(t).attr("value"),a=$(t).attr("class");if(a.match(/group/)){e="";var n=$("input,select",t);n.each(function(t){e+=$(this).val(),a.match(/email/)&&0==t&&$(this).val().length>0&&(e+="@")})}var d={isError:!1,failed:function(t,i){var e=msgs[i];i.match(/min/)&&a.match(/min(\d+)/)?e=RegExp.$1+msgs[i]:i.match(/max/)&&a.match(/max(\d+)/)&&(e=RegExp.$1+msgs[i]),$.tip.msg(t.id,e),$.tip.fadeIn(t.id),this.isError=!0}},s=$.validate.chk;for(c in s)if(a.match(/required|check|radio/)&&$("#"+t.id+"_tip").addClass("requiredTip"),a.match(c))if("function"!=typeof s[c]){if(e&&!e.match(s[c])){d.failed(t,c);break}}else if(!s[c](e,t)){d.failed(t,c);break}d.isError||$.tip.fadeOut(t.id)}},$.fn.validation=function(t){if($(this).length<1)return!1;var i=this,e=500;if(!t)var t={};var a=$.extend({dialog:!0,submit:"#submit",position:"left",top:0,left:15,AjaxZip2:!1,zip:"zip",zip2:null,pref:"pref",addr1:"addr",addr2:null,addr3:null},t.extension),n=$("input[type='text'],input[type='password'],textarea,select",i).filter(function(){return this.className.match(/required|retype|email|hankaku|numonly|tel|zip/)}),d=function(i){$.validate.fn(i,t.msgs),a.dialog||setTimeout(function(){$("div.requiredTip:visible").length>0?$(a.submit).attr("disabled","disabled").addClass("disabled"):$(a.submit).removeAttr("disabled").removeClass("disabled")},500)};if(n.each(function(){$.tip.create(this.id,"",a.position,a.top,a.left,e--),d(this),$(this).keyup(function(){d(this)}).blur(function(){d(this)}),$(this).filter("select").change(function(){d(this)})}),$(".group,.check,.radio").each(function(){var t=this;$.tip.create(this.id,"",a.position,a.top,a.left),d(this),$(this).hasClass("group")?($("input",this).keyup(function(){d(t)}).blur(function(){d(t)}),$("select",this).change(function(){d(t)})):$("input",this).click(function(){d(t)})}),a.dialog&&$.dialog.create(msgs.submit),$("*[type='submit'],input[type='image']",i).click(function(){if($("div.requiredTip:visible").length>0){var i=$("div.requiredTip:visible").eq(0).attr("id").replace("_tip","");return $("#"+i).focus().css("background","#ffc4c4","border:1px solid #CCCCCC;"),$.dialog.fadeIn(msgs.submit,t.dialog),!1}}),a.AjaxZip2){var s=function(){AjaxZip2.zip2addr(a.zip,a.pref,a.addr1,a.zip2,a.addr2,a.addr3),setTimeout(function(){n.each(function(){d(this)})},10)};$("input[name='"+(null!=a.zip2?a.zip2:a.zip)+"']").keyup(function(){s()}).blur(function(){s()})}};